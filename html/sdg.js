var A="";var W="";var x="";var K=["all"];var m="frequency";var U=500;var s=3;var G=7200;var o=0;var V=false;var Y=false;var Q=true;var q=true;var j=100;var $=false;var c="";var Z="";var z="none";var r=false;var X=false;const J=window.location.search;const e=new URLSearchParams(J);if(e.has("gateway"))W=e.get("gateway");if(e.has("device"))A=e.get("device");if(e.has("scpiheight"))x=e.get("scpiheight");if(e.has("view"))K=e.getAll("view");if(e.has("demo"))r=true;var ee=window.location.href;if(ee.includes("github.io"))r=true;var a="";function te(){if(W){a=W}else if(!a){a="ws://"+window.location.host}console.log("wsGateway: "+a)}function ae(e){if(c!=e){if(_t.includes(e)){H({action:"setDevice",argument:e});c=e}}}function ne(){field=p("devices");if(field.value<_t.length){ae(_t[field.value]);M("*IDN?",true);T()}}function re(){el=document.getElementsByClassName("checkrow");for(i=0;i<el.length;i++){el[i].onclick=function(e){var t=e.currentTarget;if(t.classList.contains("green")){t.classList.remove("green");t.cells[0].firstElementChild.checked=false}else{t.classList.add("green");t.cells[0].firstElementChild.checked=true}}}}function ie(e,t){if(t==="accept"){el=document.getElementsByClassName("cb");var a=true;for(i=0;i<el.length;i++){if(el[i].checked===false){a=false}}if(a||e.shiftKey){se(true)}else{alert("You must agree to each clasue")}}else{el=document.getElementsByClassName("checkrow");for(i=0;i<el.length;i++){el[i].classList.remove("green");el[i].cells[0].firstElementChild.checked=false}alert("Launching demo mode with fake static data.\nNothing is sent to a real device.");r=true;se(false)}}document.addEventListener("DOMContentLoaded",function(){if(r){se(false);return}p("accept").onclick=function(e){ie(e,"accept")};p("decline").onclick=function(e){ie(e,"decline")};re();var e=Number(localStorage.getItem("disclaimer"));if(Date.now()-e<7654321012){se(false)}else{p("disclaimer").style.display="block"}});function se(e){if(e)localStorage.setItem("disclaimer",Date.now());p("disclaimer").style.display="none";setTimeout(()=>{_("vfdarea",false)},"900");bt();ht();p("logo").onclick=function(){location.replace(location.origin)};p("devices").onchange=function(){ne()};p("screenbmp").onclick=function(){Ye()};p("frequency").onclick=function(){Ee("toggle")};var t=["banner","frontpanel","counter","helppage"];t.forEach(e=>{p(e).onmouseenter=function(e){ve(e)};p(e).onmouseleave=function(e){ve(e)}});if(a==false){p("helppage").style.display="block"}if(-1==Ue.indexOf(m))m="frequency";document.addEventListener("keydown",je);document.addEventListener("click",qe);var a=false;K.forEach(e=>{switch(e){case"frontpanel":Oe("on");a=true;break;case"counter":Re("on");a=true;break;case"tools":ut("on");a=true;break;case"help":lt("on");a=true;break;case"logs":Fe("on");a=true;break;case"all":p("frontpanel").style.display="block";Re("on");ut("on");a=true;break}})}const oe={"!":"KB_FUNC1","@":"KB_FUNC2","#":"KB_FUNC3",$:"KB_FUNC4","%":"KB_FUNC5","^":"KB_FUNC6",Escape:"KB_FUNC6",1:"KB_NUMBER_1",2:"KB_NUMBER_2",3:"KB_NUMBER_3",4:"KB_NUMBER_4",5:"KB_NUMBER_5",6:"KB_NUMBER_6",7:"KB_NUMBER_7",8:"KB_NUMBER_8",9:"KB_NUMBER_9",".":"KB_POINT",0:"KB_NUMBER_0","-":"KB_NEGATIVE",M:"KB_MOD",S:"KB_SWEEP",B:"KB_BURST",P:"KB_PARAMETER",U:"KB_UTILITY",D:"KB_STORE_RECALL",W:"KB_WAVES",C:"KB_CHANNEL",ArrowUp:"KB_KNOB_RIGHT",ArrowLeft:"KB_LEFT",Backspace:"KB_LEFT",Enter:"KB_KNOB_DOWN",ArrowRight:"KB_RIGHT",ArrowDown:"KB_KNOB_LEFT","[":"KB_OUTPUT1","]":"KB_OUTPUT2","{":"INT_TRIGGER1","}":"INT_TRIGGER2",L:"INT_TOGGLELOGS",ilcopy:"INT_COPYLOGS",ilclr:"INT_CLEARLOGS","?":"INT_SHOWHELP",H:"INT_SHOWHELP",A:"INT_SHOWAWG",T:"INT_SHOWTOOLS",F:"INT_SHOWCOUNTER",R:"INT_REFRESH",K:"INT_BEEP",issend:"INT_SCPI_SEND",isclr:"INT_SCPI_CLEAR",iscopy:"INT_SCPI_COPY",isccsv:"INT_SCPI_COPYCSV",icrn:"INT_CTR_REFRESH_ON",icrf:"INT_CTR_REFRESH_OFF",icon:"INT_CTR_ONOFF",icdf:"INT_CTR_DISP_FREQ",icdt:"INT_CTR_DISP_TIME",icdo:"INT_CTR_DISP_OTHER",icf:"INT_CTR_FAST",icac:"INT_CTR_AC",ichf:"INT_CTR_HFR"};const ce={R:"INT_CTR_REFRESH_ON",S:"INT_CTR_REFRESH_OFF",P:"INT_CTR_ONOFF",F:"INT_CTR_DISP_FREQ",T:"INT_CTR_DISP_TIME",O:"INT_CTR_DISP_OTHER",G:"INT_CTR_FAST",A:"INT_CTR_AC",H:"INT_CTR_HFR"};var le=["KB_MOD","KB_SWEEP","KB_BURST","KB_CHANNEL"];var fe=["KB_PARAMETER","KB_UTILITY","KB_STORE_RECALL","KB_WAVES"];var ue=le.concat(fe);function Te(e){if(ue.includes(e)){H({action:"ledHack",argument:e})}}function de(t){fe.forEach(e=>{if(e==t){document.getElementsByName(t)[0].classList.add("onon")}else{document.getElementsByName(e)[0].classList.remove("onon")}})}function ve(e){if(e.type=="mouseenter"){z=e.originalTarget.id}if(e.type=="mouseleave"){z="none"}}var me;function l(e,t){if(typeof websocket!="object"||websocket.readyState!=1){pe()}if(t){var a=document.getElementsByName(e)[0];$e(a)}var n=true;if(Object.values(oe).includes(e)){Te(e);switch(e){case"INT_TOGGLELOGS":Fe("toggle");break;case"INT_CLEARLOGS":p("errorlogs").innerHTML="";At="";break;case"INT_COPYLOGS":n=mt("logmsgs");break;case"INT_SHOWHELP":ke();break;case"INT_SHOWAWG":Oe();break;case"INT_SHOWTOOLS":we();break;case"INT_SHOWCOUNTER":Re();break;case"INT_BEEP":Qe();break;case"INT_REFRESH":Ye();break;case"INT_TRIGGER1":n=Ie(1);break;case"INT_TRIGGER2":n=Ie(2);break;case"INT_SCPI_SEND":Ze();break;case"INT_SCPI_CLEAR":P("","clear");break;case"INT_SCPI_COPY":n=mt("scpitext");break;case"INT_SCPI_COPYCSV":n=mt("scpicsv");break;case"INT_CTR_ONOFF":Me();break;case"INT_CTR_DISP_FREQ":n=Ge("f");break;case"INT_CTR_DISP_TIME":n=Ge("t");break;case"INT_CTR_DISP_OTHER":n=Ge("o");break;case"INT_CTR_REFRESH_ON":n=Ee("on");break;case"INT_CTR_REFRESH_OFF":n=Ee("off");break;case"INT_CTR_FAST":n=Le();break;case"INT_CTR_AC":n=Pe("a");break;case"INT_CTR_HFR":n=Pe("h");break;default:if(e.match(/^KB_/)){var r="vkey value,"+e+",state,1";M(r,false);f(s)}else{console.log(`unknown key ${e}`)}}if(n){ge()}else{pe()}}else{pe()}}function pe(){if(g("beep"))Ft(220,.5,"square",100)}function ge(){if(g("beep"))Ft(880,.5,"sine",50)}function f(e){if(e>0){Ve("On");if(t==undefined){T();t=setInterval(T,U);u=e}else{if(e>u)u=e}}else{t=clearInterval(t);u=0;Ve("Off")}}var Ne;var t;var u=0;function T(){var e=p("screenbmp");if(r){e.src="sample.bmp";b("screenbmp","staleinfo")}else{M("scdp",false)}if(t!=undefined){u--;if(u<=0){t=clearInterval(t);u=0;Ve("off")}}M("C1:outp?\nC2:outp?\n"+"C1:mdwv?\nC2:mdwv?\n"+"C1:btwv?\nC2:btwv?\n"+"C1:swwv?\nC2:swwv?\n",false);if(o){clearTimeout(Ne);Ne=setTimeout(()=>{S("screenbmp","staleinfo")},o*1e3)}}var d;function Ee(e){if(!g("onoffFCNT"))return false;switch(e){case"on":v("on");break;case"off":if(d==undefined){M("FCNT?",false)}else{v("off")}break;case"toggle":if(d==undefined){v("on")}else{v("off")}break}return true}function v(e){if(e=="on"){if(d==undefined){d=setInterval(M,500,"FCNT?",false)}N("refreshFCNT_on");C("refreshFCNT_off");return}else{d=clearInterval(d);C("refreshFCNT_on");N("refreshFCNT_off")}}function Ce(e){if(e["MODE"].match(/AC/i)){N("acLed")}else{C("acLed")}if(e["HFR"].match(/on/i)){N("hfrLed")}else{C("hfrLed")}if(e["TYPE"].match(/fast/i)){N("fastFCNT")}else{C("fastFCNT")}}function he(e){if(e.match(/off/i)){C("onoffFCNT");C("freqFCNT");C("timeFCNT");C("otherFCNT");C("refreshFCNT_off");C("refreshFCNT_on");C("acLed");C("hfrLed");C("fastFCNT")}else{N("onoffFCNT")}}function p(e){return document.getElementById(e)}function g(e){return p(e).classList.contains("green")}function N(e){b(e,"red");b(e,"yellow");S(e,"green");b(e,"black")}function _e(e){b(e,"red");S(e,"yellow");b(e,"green");b(e,"black")}function E(e){S(e,"red");b(e,"yellow");b(e,"green");b(e,"black")}function C(e){b(e,"red");b(e,"yellow");b(e,"green");S(e,"black")}function h(e){b(e,"red");b(e,"yellow");b(e,"green");b(e,"black")}function _(e,t){if(t){S(e,"cyanblack")}else{b(e,"cyanblack")}}function Se(e,t){p(e).className=t}function S(e,t){p(e).classList.add(t)}function b(e,t){p(e).classList.remove(t)}lastWheelSent=0;function be(e){e.preventDefault();var t=Date.now();if(t-lastWheelSent>100){if(e.wheelDeltaY>=2){l("KB_KNOB_RIGHT",true);lastWheelSent=Date.now()}if(e.wheelDeltaY<=-2){l("KB_KNOB_LEFT",true);lastWheelSent=Date.now()}}}function Re(e){if(e=="on"||!g("counterBut")){ct("on");v("on")}else{ct("off");v("off")}}function Fe(e){switch(e){case"on":p("logspanel").style.display="block";N("logsBut");break;case"off":p("logspanel").style.display="none";h("logsBut");break;default:if(p("logspanel").style.display=="block"){p("logspanel").style.display="none";h("logsBut")}else{p("logspanel").style.display="block";N("logsBut")}break}}var ye=0;function ke(){switch(p("scpitext").value){case"clear":localStorage.clear();p("scpitext").value="done";break;case"timing":alert("scdpTimings "+Kt(Pt)+"\n"+"pyScdpTimings "+Kt(Mt)+"\n"+"wsTimings "+Kt(Ht));lastMessageTime=Date.now();break;case"cleartiming":Pt=[0];Mt=[0];Ht=[0];break;default:if(g("helpBut")){window.scroll(0,0);lt("off")}else{lt("on");p("helppage").scrollIntoView({behavior:"smooth",block:"start"})}break}}function Oe(e){f(s);if(e=="off"||g("awgBut")){ft("off");return}if(e=="on"||!g("awgBut")){ft("on");return}}function we(){if(g("toolsBut")){ut("off")}else{ut("on")}f(s)}function Ie(t){var e=true;const a=["btwv","swwv"];var n="";a.forEach(e=>{if(et[e+t]=="on"){n="C"+t+":"+e.toUpperCase()+" MTRIG"}});if(n){N("trigger"+t);M(n,false)}else{E("trigger"+t);e=false}setTimeout(()=>{h("trigger"+t)},"200");f(s);return e}var Be=1;var De=[.5,1,10,100,1e3];function Le(){if(!g("onoffFCNT"))return false;if(!$){if(g("fastFCNT")){M("FCNT TYPE,SLOW",false)}else{M("FCNT TYPE,FAST",false)}}else{Be++;Be%=De.length;var e=De[Be];if(e==.5){M("FCNT TYPE,FAST",false);O=false}else if(e==1){M("FCNT TYPE,SLOW",false);O=false}else{M("FCNT TYPE,SLOW",false);O=true;rt=e;w.S.length=0;w.nextPtr=0}}f(s);return true}function Pe(e){if(!g("onoffFCNT"))return false;if(e=="a"){if(g("acLed")){M("FCNT MODE,DC",false)}else{M("FCNT MODE,AC",false)}}if(e=="h"){if(g("hfrLed")){M("FCNT HFR,OFF",false)}else{M("FCNT HFR,ON",false)}}f(s);return true}function Me(){if(g("onoffFCNT")){M("FCNT STATE,OFF",false);st="";M("FCNT?",false)}else{M("FCNT STATE,ON",false);v("on")}f(s)}function He(e){switch(e){case"f":N("freqFCNT");C("timeFCNT");C("otherFCNT");break;case"t":C("freqFCNT");N("timeFCNT");C("otherFCNT");break;case"o":C("freqFCNT");C("timeFCNT");N("otherFCNT");break}}var Ae="f";const We=["frequency","reference"];const xe=["period","pWidth","nWidth","gate"];const Ke=["deviation","duty","trigLev"];const Ue=We.concat(xe,Ke);function Ge(e){if(!g("onoffFCNT"))return false;var t;switch(e){case"f":t=We.indexOf(m);t=(t+1)%We.length;m=We[t];Ae="f";break;case"t":t=xe.indexOf(m);t=(t+1)%xe.length;m=xe[t];Ae="t";break;case"o":t=Ke.indexOf(m);t=(t+1)%Ke.length;m=Ke[t];Ae="o";break}if(g("refreshFCNT_off")){ot(st,false)}return true}function Ve(e){if(e.match(/on/i)){N("refresh")}else{h("refresh")}}function Ye(){if(t==undefined){f(G)}else{f(0)}}function Qe(){if(g("beep")){h("beep")}else{N("beep");audioCtx=new(window.AudioContext||window.webkitAudioContext)}}function qe(e){const t=e.target.nodeName==="BUTTON";if(!t)return;l(e.target.name,false)}function je(e){me=Date.now();var t=e.key;if(t.length==1){t=t.toUpperCase()}if(z=="helppage"){if(t!="H"){return}}if(document.activeElement.id=="scpitext"){switch(t){case"Enter":Ze("user");R=0;break;case"ArrowUp":if(++R<F.length){p("scpitext").value=F[R]}else{R=F.length-1}break;case"ArrowDown":if(--R>=0){p("scpitext").value=F[R]}else{p("scpitext").value="";R=-1}break}}if(t=="Enter"){if(document.activeElement.id=="macros"){Ze()}}if(document.activeElement.classList.contains("nokey")){return}if(e.altKey&&e.ctrlKey&&t=="F"){var a=p("frequency").style.fontFamily;if(a=="FourteenSeg"){a="SevenSeg"}else{a="FourteenSeg"}p("frequency").style.fontFamily=a;return}if(e.altKey||e.ctrlKey||e.metaKey){return}var n=false;if(n&&z=="counter"){if(t in ce){var r=ce[t];l(r,true);e.preventDefault();var i=document.getElementsByName(r)[0];$e(i)}}else{if(t in oe){var r=oe[t];l(r,true);e.preventDefault();var i=document.getElementsByName(r)[0];$e(i)}}}function $e(e){if(e){e.classList.add("active");setTimeout(()=>{e.classList.remove("active")},"100")}}var R=0;var F=[];function Ze(e){var t=p("scpitext").value;var a=p("macro12").value;if(e!="user"){var n=p("macros").value;if(n>=1&&n<Ct.length){t=Ct[n]}}if(t.match(/^scdp/i)){P("","clear");P("Refusing to ask for binary junk!","notable");return}if(t.match(/^MCBD?/i)){P("","clear");P("Sorry, MCDB? only works using telnet to port 5024","notable");return}if(t.length>0){t.split(/&/).forEach(e=>{if(a==1||a==2){e=e.replace(/^C\?:/i,`C${a}:`)}M(e,true)});f(s);if(e=="user"||Q){if(F[0]!=t){F.unshift(t)}}}}function ze(e){var t=e.split(",");var a=t[0];Z=t[1];p("model").innerHTML=Z;document.title=`${Z}@${c}`}function Xe(e){var t;if(t=e.match(/^ROSC (int|ext),10MOUT,(on|off)/i)){var a=t[1];var n=t[2];if(a.match(/^ext/i)){_("extrefLed",true)}else{_("extrefLed",false)}}}function Je(e){var t;if(t=e.match(/^C(\d):OUTP (on|off),/i)){var a=t[1];var n=t[2].toLowerCase();if(n.match(/^on/i)){N("ch"+a)}else{C("ch"+a)}}}var y={};var et={};function tt(e){var t;if(t=e.match(/^C(\d):(MDWV|SWWV|BTWV) STATE,(on|off),*/i)){var a=t[1];var n=t[2].toLowerCase();var r=t[3].toLowerCase();y[n+a]=r}if(Object.keys(y).length==6){if(Object.values(et).toString()!=Object.values(y).toString()){const i=["mdwv","btwv","swwv"];i.forEach(e=>{var t=y[e+"1"]+y[e+"2"];b(e,"offoff");b(e,"offon");b(e,"onoff");b(e,"onon");S(e,t)});et=Object.assign({},y);y={}}}}var at=["uS","sec","MHz","Hz","pcent"];function nt(){_("AverageLed",O);Ue.forEach(e=>{if(e==m){_(e+"Led",true)}else{_(e+"Led",false)}});at.forEach(e=>{_(e,false)});switch(m){case"frequency":case"reference":_("Hz",true);break;case"duty":_("pcent",true);break;case"deviation":case"trigLev":break;default:_("sec",true);break}}function k(e){p("frequency").innerHTML=e}var O=false;var w={S:[],nextPtr:0};const I={};var rt=100;function it(e){if(w.S[w.nextPtr-1]==undefined||Object.values(w.S[w.nextPtr-1]).toString()!=Object.values(e).toString()){w.S[w.nextPtr++]=e;sum=w.S.map(e=>e.FRQ).reduce((e,t)=>e+t,0);I["FRQ"]=sum/w.S.length;sum=w.S.map(e=>e.DUTY).reduce((e,t)=>e+t,0);I["DUTY"]=sum/w.S.length;sum=w.S.map(e=>e.REFQ).reduce((e,t)=>e+t,0);I["REFQ"]=sum/w.S.length;sum=w.S.map(e=>e.PW).reduce((e,t)=>e+t,0);I["PW"]=sum/w.S.length;sum=w.S.map(e=>e.NW).reduce((e,t)=>e+t,0);I["NW"]=sum/w.S.length;sum=w.S.map(e=>e.PER).reduce((e,t)=>e+t,0);I["PER"]=sum/w.S.length;sum=w.S.map(e=>e.FREQDEV).reduce((e,t)=>e+t,0);I["FREQDEV"]=sum/w.S.length;I["MODE"]=e["MODE"];I["HFR"]=e["HFR"];I["TYPE"]=e["TYPE"];if(w.nextPtr>=rt)w.nextPtr=0}}var st="";function ot(e,t){var a={};if(g("refreshFCNT_off")){e=st}var n="Counter!Off!";if(e.startsWith("FCNT STATE,OFF")){he("Off");k(n)}if(e.startsWith("FCNT STATE,ON")){st=e;he("On");var r=e.split(",");a={STATE:r[1],FRQ:Number(r[3].replace(/HZ$/i,"")),DUTY:Number(r[5]),REFQ:Number(r[7].replace(/HZ/,"")),TRIG:Number(r[9].replace(/V$/,"")),PW:Number(r[11].replace(/S$/,"")),NW:Number(r[13].replace(/S$/,"")),FREQDEV:r[15].replace(/ppm/,"")*1e3,MODE:r[17],HFR:r[19],TYPE:r[21]};a["PER"]=a["PW"]+a["NW"];if(t){it(a)}nt();He(Ae);Ce(a);if(O){var i=I}else{var i=a}switch(m){case"frequency":var n=i["FRQ"];var s=9;if(n>1e6){n=n/1e6;_("MHz",true);s=9}else if(n>1e3){_("MHz",false);s=6}else if(n>1){_("MHz",false);s=9}n=n.toLocaleString("en-US",{minimumFractionDigits:s,maximumFractionDigits:s});k(n);break;case"reference":var o=i["REFQ"];if(o>1e6){o=o/1e6;_("MHz",true)}else{_("MHz",false)}o=o.toLocaleString("en-US",{minimumSignificantDigits:6,maximumSignificantDigits:6,roundingMode:"trunc"});k(o);break;case"period":case"pWidth":case"nWidth":case"gate":var c=i["PW"];var l=i["NW"];var f=i["PER"];var u;var T=6;switch(m){case"period":u=f;break;case"pWidth":u=c;break;case"nWidth":u=l;break;case"gate":T=4;if(O){u=De[Be]}else if(i["TYPE"].match(/fast/i)){u=.5}else{u=1};break}if(u<1e-6){u*=1e6;_("uS",true)}u=u.toLocaleString("en-US",{minimumSignificantDigits:T,maximumSignificantDigits:T,roundingMode:"halfExpand"});k(u);break;case"duty":k((Math.round(i["DUTY"]*100)/100).toFixed(2));break;case"deviation":var d=i["FREQDEV"];if(Math.abs(d)<1e7){d=d.toLocaleString("en-US",{minimumFractionDigits:3,maximumFractionDigits:3,roundingMode:"trunc"})}else{d="out!of!range"}k(d);break;case"trigLev":var v=i["TRIG"];v=v.toFixed(3);k(v+"!v!");break}}}function ct(e){if(e=="on"){N("counterBut");p("counter").style.display="block"}else{h("counterBut");p("counter").style.display="none"}}function lt(e){if(e=="on"){N("helpBut");p("helppage").style.display="block"}else{h("helpBut");p("helppage").style.display="none"}}function ft(e){if(e=="on"){N("awgBut");p("frontpanel").style.display="block"}else{h("awgBut");p("frontpanel").style.display="none"}}function ut(e){if(e=="on"){N("toolsBut");p("scpitools").style.display="block"}else{h("toolsBut");p("scpitools").style.display="none"}}function B(e){switch(e){case"green":N("txbut");N("txFCNT");break;case"yellow":_e("txbut");_e("txFCNT");break;case"red":E("txbut");E("txFCNT");break;default:h("txbut");C("txFCNT");break}}function D(e){switch(e){case"green":N("rxbut");break;case"yellow":_e("rxbut");break;case"red":E("rxbut");break;default:h("rxbut");break}}var Tt=0;function dt(e,t){if(e.toString().startsWith("4")){var a=(new Date).getTime()/1e3;if(a-Tt>5){f(0);v("off");alert(e+": "+t);Tt=a;B("")}}else{alert(t)}}function vt(e){if(window.clipboardData&&window.clipboardData.setData){return clipboardData.setData("Text",e)}else if(document.queryCommandSupported&&document.queryCommandSupported("copy")){var t=document.createElement("textarea");t.textContent=e;t.style.position="fixed";document.body.appendChild(t);t.select();try{return document.execCommand("copy")}catch(e){console.warn("Copy to clipboard failed.",e);return false}finally{document.body.removeChild(t)}}}function mt(e){if(e=="scpitext"&&L){vt(L);return true}else if(e=="scpicsv"&&pt){vt(pt);return true}else if(e=="logmsgs"&&At){vt(At);return true}else{return false}}var L="";var pt="";function P(e,t){var a=p("scpireplies");var n=p("csvtable");for(var r=0;r<n.rows.length;){n.deleteRow(r)}pt="";if(t=="clear"){p("43").style.display="none";L="";a.innerHTML="";return}if(e.length==0)return;if(q==true){L+=e+"\n";a.innerHTML+=`<div class="nokey scpireply">${e}</div>`}else{L=e+"\n";a.innerHTML=`<div class="nokey scpireply">${e}</div>`}if(t!="notable"){e=e.replace(" ",",");var i=e.split(/,/);var s=i.length;if(s%2==1){s=i.unshift(i[0]);i[1]=""}for(var r=0;r<s;r+=2){pt+=`${i[r]},${i[r+1]}\n`;var o=n.insertRow(-1);var c=o.insertCell(0);var l=o.insertCell(1);c.innerHTML=i[r];l.innerHTML=i[r+1]}p("43").style.display="block"}}var gt=`Siglent Technologies,SDGDEMO!,SDG42424242242,2.01.01.38
C1:OUTP ON,LOAD,50,POWERON_STATE,0,PLRT,NOR
C2:OUTP ON,LOAD,50,POWERON_STATE,0,PLRT,NOR
C1:MDWV STATE,ON,FM,MDSP,ARB,INDEX,63,SRC,INT,FRQ,1HZ,DEVI,50000HZ,CARR,WVTP,SINE,FRQ,108000000HZ,AMP,0.632551V,AMPVRMS,0.223607Vrms,AMPDBM,0dBm,OFST,0V,PHSE,0
C2:MDWV STATE,OFF
C1:BTWV STATE,OFF
C2:BTWV STATE,OFF
C1:SWWV STATE,OFF
C2:SWWV STATE,ON,TIME,23S,STOP,773999HZ,START,773999HZ,TRSR,INT,TRMD,OFF,SWMD,LINE,DIR,UP,SYM,5419472.01183249,MARK_STATE,OFF,MARK_FREQ,0HZ,IDLE_FREQ,START_FREQ,CARR,WVTP,SINE,FRQ,773999HZ,AMP,0.632551V,AMPVRMS,0.223607Vrms,AMPDBM,-7.47755e-07dBm,OFST,0V,PHSE,0
FCNT STATE,ON,FRQ,10000000.07HZ,DUTY,46.5815,REFQ,1e+07HZ,TRG,4.38538e-15V,PW,4.65815e-08S,NW,5.34185e-08S,FRQDEV,0.00667211ppm,MODE,AC,HFR,OFF,TYPE,SLOW 
`;function Nt(e,t){if(t)P(e,"");lines=e.split("\n");lines.forEach(e=>{if(e.startsWith("FCNT ")){ot(e,true)}if(e.startsWith("Siglent ")){ze(e)}if(e.match(/^C\d:(MDWV|BTWV|SWWV) /i)){tt(e)}if(e.match(/^C\d:OUTP /)){Je(e)}if(e.match(/^ROSC /)){Xe(e)}})}function Et(e,t){B("yellow");if(t){Nt("DEMO STATE,ON,FRQ,10000000.07HZ,DUTY,46.5815,"+"REFQ,1e+07HZ,TRG,4.38538e-15V,PW,4.65815e-08S,"+"NW,5.34185e-08S,FRQDEV,0.00667211ppm,"+"MODE,AC,HFR,OFF,TYPE,SLOW",t)}else{Nt(gt,t)}setTimeout(()=>{B("")},200);return}function M(e,t){if(t==undefined)t=false;if(e=="")return;if(r){Et(e,t);return}var a="scpiCmd";if(e.includes("?")){a="scpiQuery"}else if(e.match(/^scdp/i)){a="scdp"}else{a="scpiCmd"}H({action:a,argument:e,updateResponse:t})}var Ct=["Free Text"];function ht(){const e=new XMLHttpRequest;e.open("GET","sdg-macros.json");e.send();e.responseType="json";e.onload=()=>{if(e.readyState==4&&e.status==200){const r=e.response;var a=p("macros");var n=1;Object.keys(r).forEach(e=>{if(r[e]){Ct.push(r[e]);var t=document.createElement("option");t.text=e;t.value=n++;a.add(t)}else{var t=document.createElement("optgroup");t.label=e;a.add(t)}})}else{console.log(`Error readMacros() : ${e.status}`)}}}var _t=[];function St(a){data=Object.keys(a["value"]);var n=p("devices");n.length=0;c=a["currentDevice"];var r=0;data.forEach(e=>{_t.push(e);var t=document.createElement("option");t.text=e;t.value=r++;if(e==a["currentDevice"]){t.selected=true}n.add(t)})}function bt(){const t=new XMLHttpRequest;t.open("GET","sdg-config.json");t.send();t.responseType="json";t.onload=()=>{if(t.readyState==4&&t.status==200){const e=t.response;if("updateTime"in e)U=e.updateTime;if("smallUpdateCycles"in e)s=e.smallUpdateCycles;if("longUpdateCycles"in e)G=e.longUpdateCycles;if("scrollWheel"in e)V=e.scrollWheel;if("idleTimeout"in e)o=e.idleTimeout;if("highlightNew"in e)Y=e.highlightNew;if("macrosUpdateHistory"in e)Q=e.macrosUpdateHistory;if("scpiResultsAppend"in e)q=e.scpiResultsAppend;if("scpiHeightPx"in e)j=Number(e.scpiHeightPx);if("wsGateway"in e)a=e.wsGateway;if("counterAveraging"in e)$=e.counterAveraging;Rt();if(!r){te();Ot()}else{T();St(Object({type:"getDevices",currentDevice:"demo.device",value:{"demo.device":""}}))}}else{console.log(`Error readConfig() : ${t.status}`)}}}function Rt(){if(x>0)j=x;p("42").style.height=j+"px";p("43").style.height=j+"px";if(V==true)p("navknob").onwheel=function(e){be(e)}}function Ft(e,t,a,n){if(!audioCtx)return;var r=audioCtx.createOscillator();var i=audioCtx.createGain();r.connect(i);i.connect(audioCtx.destination);i.gain.value=t;r.frequency.value=e;r.type=a;r.start();setTimeout(()=>{r.stop()},n)}function yt(e){p("userCount").innerHTML=e}function H(e){if(typeof websocket=="object"&&websocket.readyState==1){B("green");setTimeout(()=>{B("")},100);websocket.send(JSON.stringify(e))}else{B("red")}}function kt(){H({action:"ping",argument:Date.now()});if(Date.now()-lastMessageTime>5e3){console.log(Date.now()-lastMessageTime);Lt()}}function Ot(){console.log("Trying to open a WebSocket connection...");websocket=new WebSocket(a);websocket.onopen=Bt;websocket.onclose=Dt;websocket.onmessage=xt}var wt;var It=0;function Bt(){console.log("ws opened");B("");D("");It=0;H({action:"getDevices"});if(wt)clearInterval(wt);wt=setInterval(kt,3e3)}function Dt(){console.log("ws closed");B("red");D("red");if(It++<5){setTimeout(()=>{Ot()},500)}else{Lt()}}function Lt(){var e=confirm("Lost connection to sdg proxy.\nReload page to retry?");if(e)location.reload()}var Pt=[0];var Mt=[0];var Ht=[0];var At="";var Wt;function xt(e){lastMessageTime=Date.now();D("green");setTimeout(()=>{D("")},100);const t=JSON.parse(e.data);if(t.hasOwnProperty("currentDevice")){if(c!=t["currentDevice"]){c=t["currentDevice"]}}switch(t.type){case"error":var a=p("errorlogs");At+=t.value+"\n";a.innerHTML+=`<div class="nokey errorlog">${t.value}</div>`;E("logsBut");setTimeout(()=>{h("logsBut")},100);D("red");break;case"users":yt(t.count);break;case"scdp":n=Date.now();if(t.time>0){Mt.push(t.time);Mt[0]++}if(Wt!=t.value){Wt=t.value;var r=p("screenbmp");r.src="data:image/png;base64,"+t.value;if(Y){S("screenbmp","newimg");highlightBlur=setTimeout(()=>{b("screenbmp","newimg")},50)}if(me){var i=Date.now()-me;me="";Pt.push(Number(i));Pt[0]++}}b("screenbmp","staleinfo");if(o){clearTimeout(Ne);Ne=setTimeout(()=>{S("screenbmp","staleinfo")},o*1e3)}break;case"scpi":Nt(t.value,t.updateResponse);break;case"getDevices":St(t);if(!X){X=true;if(A){ae(A)}T();M("*IDN?",true)}break;case"ledHack":de(t.value);break;case"pong":var i=Date.now()-t.value;Ht.push(i);Ht[0]++;break;default:console.error("unsupported msg",t)}}function Kt(e){var t=e[0];var a=e.slice(1);var n=Math.max.apply(null,a);var r=Math.min.apply(null,a);return"count: "+t+", range: "+(n-r)+", mean: "+(n+r)/2}
